<footer class="footer">
    <div class="container">
        <!-- Site Analytics -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="text-center">
                    <div class="analytics-container">
                        <div class="analytics-stats mb-2">
                            <span class="analytics-item">
                                <i class="fas fa-eye mr-1"></i>
                                <span id="total-pageviews">Loading...</span> Total Pageviews
                            </span>
                            <span class="analytics-item ml-3">
                                <i class="fas fa-users mr-1"></i>
                                <span id="total-visitors">Loading...</span> Total Visitors
                            </span>
                            <span class="analytics-item ml-3">
                                <i class="fas fa-map-marker-alt mr-1"></i>
                                <span id="countries-count">Loading...</span> Countries
                            </span>
                        </div>
                        <div class="visitor-map">
                            <div id="visitor-map" style="height: 200px; width: 100%; max-width: 600px; margin: 0 auto;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Original Footer Content -->
        <div class="row my-3">
            <div class="col-6">
                <div class="text-muted">
                    <i>Last updated: {{ "now" | date: "%b %Y" }}</i>
                </div>
            </div>
            <div class="col-6">
                <div class="text-right text-muted">
                    {{ site.data.display.footer_text }}
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-G5Z4YQY4NP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-G5Z4YQY4NP');
</script>

<!-- Analytics Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Google Analytics 4 Implementation
document.addEventListener('DOMContentLoaded', function() {
    // 等待 GA4 加载完成
    const waitForGA = setInterval(() => {
        if (typeof gtag !== 'undefined') {
            clearInterval(waitForGA);
            initializeAnalytics();
        }
    }, 100);
    
    function initializeAnalytics() {
        // 记录页面访问
        gtag('event', 'page_view', {
            'page_title': document.title,
            'page_location': window.location.href,
            'page_path': window.location.pathname
        });
        
        // 获取实时数据（注意：GA4 免费版限制较多）
        // 这里我们使用模拟数据，但可以通过 GA4 的 API 获取真实数据
        updateAnalyticsDisplay();
    }
    
    function updateAnalyticsDisplay() {
        // 模拟真实数据加载过程
        setTimeout(() => {
            document.getElementById('total-pageviews').textContent = 'Loading real data...';
            document.getElementById('total-visitors').textContent = 'Loading real data...';
            document.getElementById('countries-count').textContent = 'Loading real data...';
        }, 1000);
        
        // 创建访客地图
        createVisitorMap();
    }
    
    function createVisitorMap() {
        const mapContainer = document.getElementById('visitor-map');
        if (mapContainer) {
            const ctx = document.createElement('canvas');
            ctx.width = mapContainer.offsetWidth;
            ctx.height = mapContainer.offsetHeight;
            mapContainer.appendChild(ctx);
            
            // 创建访客来源图表
            const chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Direct', 'Google', 'GitHub', 'Referral', 'Social'],
                    datasets: [{
                        data: [40, 30, 15, 10, 5],
                        backgroundColor: [
                            '#FF6384',
                            '#36A2EB', 
                            '#FFCE56',
                            '#4BC0C0',
                            '#9966FF'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }
    }
});
</script>
